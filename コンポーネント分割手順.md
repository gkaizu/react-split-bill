# コンポーネント分割手順

このドキュメントでは、App.jsを複数のコンポーネントファイルに分割する手順を説明します。

## Step 1: ファイル拡張子を .js から .jsx に変更する

### 理由
- JSXを含むファイルは `.jsx` 拡張子を使うのがベストプラクティス
- コードエディタがJSXのシンタックスハイライトを正しく認識できる
- ファイルの役割が一目でわかる

### 手順
```bash
# src/App.js を src/App.jsx にリネーム
git mv src/App.js src/App.jsx
```

### 注意点
- `index.js` などで `import App from './App'` としている場合、拡張子を明示的に書いていなければ自動的に解決されます
- Reactアプリでは通常、拡張子なしでインポートするので変更不要です

---

## Step 2: components フォルダを作成する

### ディレクトリ構造
```
src/
├── components/
│   ├── App.jsx
│   ├── FriendsList.jsx
│   ├── Friend.jsx
│   ├── FormAddFriend.jsx
│   ├── FormSplitBill.jsx
│   └── Button.jsx
├── App.css
└── index.js
```

### 手順
```bash
# componentsフォルダを作成
mkdir src/components
```

---

## Step 3: 各コンポーネントを個別ファイルに分割する

### 分割するコンポーネント一覧
現在の `App.js` には以下のコンポーネントが含まれています：

1. `App` - メインコンポーネント
2. `FriendsList` - 友達リスト
3. `Friend` - 個別の友達
4. `Button` - 再利用可能なボタン
5. `FormAddFriend` - 友達追加フォーム
6. `FormSplitBill` - 割り勘フォーム

### 3-1. Button コンポーネントを分割

**新規ファイル: `src/components/Button.jsx`**
```jsx
export default function Button({ children, onClick }) {
  return (
    <button className="button" onClick={onClick}>
      {children}
    </button>
  );
}
```

### 3-2. Friend コンポーネントを分割

**新規ファイル: `src/components/Friend.jsx`**
```jsx
import Button from './Button';

export default function Friend({ friend, onSelected, selectedFriend }) {
  const isSelected = selectedFriend?.id === friend.id;

  return (
    <li className={isSelected ? "selected" : ""}>
      <img src={friend.image} alt={friend.name} />
      <h3>{friend.name}</h3>

      {friend.balance < 0 && (
        <p className="red">
          あなたが{friend.name}に払う金額: {Math.abs(friend.balance)} 円
        </p>
      )}
      {friend.balance > 0 && (
        <p className="green">
          {friend.name}があなたに払う金額: {Math.abs(friend.balance)} 円
        </p>
      )}
      {friend.balance === 0 && <p>割り勘が完了しています</p>}

      <Button onClick={() => onSelected(friend)}>
        {isSelected ? "閉じる" : "選択"}
      </Button>
    </li>
  );
}
```

### 3-3. FriendsList コンポーネントを分割

**新規ファイル: `src/components/FriendsList.jsx`**
```jsx
import Friend from './Friend';

export default function FriendsList({ friends, onSelected, selectedFriend }) {
  return (
    <ul>
      {friends.map((friend) => (
        <Friend
          friend={friend}
          key={friend.id}
          selectedFriend={selectedFriend}
          onSelected={onSelected}
        />
      ))}
    </ul>
  );
}
```

### 3-4. FormAddFriend コンポーネントを分割

**新規ファイル: `src/components/FormAddFriend.jsx`**
```jsx
import { useState } from 'react';
import Button from './Button';

export default function FormAddFriend({ onAddFriend }) {
  const [name, setName] = useState("");
  const [image, setImage] = useState("https://i.pravatar.cc/48");

  function handleSubmit(e) {
    e.preventDefault();

    if (!name || !image) return;

    const id = crypto.randomUUID();
    const newFriend = {
      id,
      name,
      image: `${image}?=${id}`,
      balance: 0,
    };

    onAddFriend(newFriend);

    setName("");
    setImage("https://i.pravatar.cc/48");
  }

  return (
    <form className="form-add-friend" onSubmit={handleSubmit}>
      <label>👬 友達の名前</label>
      <input
        type="text"
        value={name}
        onChange={(e) => setName(e.target.value)}
      />

      <label>🖼 画像のURL</label>
      <input
        type="text"
        value={image}
        onChange={(e) => setImage(e.target.value)}
      />

      <Button>追加</Button>
    </form>
  );
}
```

### 3-5. FormSplitBill コンポーネントを分割

**新規ファイル: `src/components/FormSplitBill.jsx`**
```jsx
import { useState } from 'react';
import Button from './Button';

export default function FormSplitBill({ selectedFriend, onSplitBill }) {
  const [bill, setBill] = useState("");
  const [paidByUser, setPaidByUser] = useState("");
  const paidByFriend = bill ? bill - paidByUser : "";
  const [whoIsPaying, setWhoIsPaying] = useState("user");

  function handleSubmit(e) {
    e.preventDefault();

    if (!bill || !paidByUser) return;
    onSplitBill(whoIsPaying === "user" ? paidByFriend : -paidByUser);
  }

  return (
    <form className="form-split-bill" onSubmit={handleSubmit}>
      <h2>{selectedFriend.name}と割り勘</h2>

      <label>💰 金額</label>
      <input
        type="text"
        value={bill}
        onChange={(e) => setBill(Number(e.target.value))}
      />

      <label>🧍 あなたの支払い額</label>
      <input
        type="text"
        value={paidByUser}
        onChange={(e) =>
          setPaidByUser(
            Number(e.target.value) > bill ? paidByUser : Number(e.target.value)
          )
        }
      />

      <label>👬 {selectedFriend.name}の支払い額</label>
      <input type="text" disabled value={paidByFriend} />

      <label>🤑 誰が払った？</label>
      <select
        value={whoIsPaying}
        onChange={(e) => setWhoIsPaying(e.target.value)}
      >
        <option value="user">あなた</option>
        <option value="friend">{selectedFriend.name}</option>
      </select>

      <Button>割り勘</Button>
    </form>
  );
}
```

### 3-6. App コンポーネントを更新

**更新後の `src/components/App.jsx`**
```jsx
import { useState } from "react";
import FriendsList from './FriendsList';
import FormAddFriend from './FormAddFriend';
import Button from './Button';
import FormSplitBill from './FormSplitBill';

const initialFriends = [
  {
    id: 118836,
    name: "Clark",
    image: "https://i.pravatar.cc/48?u=118836",
    balance: -7,
  },
  {
    id: 933372,
    name: "Sarah",
    image: "https://i.pravatar.cc/48?u=933372",
    balance: 20,
  },
  {
    id: 499476,
    name: "Anthony",
    image: "https://i.pravatar.cc/48?u=499476",
    balance: 0,
  },
];

export default function App() {
  const [friends, setFriends] = useState(initialFriends);
  const [showAddFriend, setShowAddFriend] = useState(false);
  const [selectedFriend, setSelectedFriend] = useState(null);

  function handleShowAddFriend() {
    setShowAddFriend((show) => !show);
  }

  function handleAddFriend(friend) {
    setFriends((friends) => [...friends, friend]);
    setShowAddFriend(false);
  }

  function handleSelection(friend) {
    setSelectedFriend((cur) => (cur?.id === friend.id ? null : friend));
    setShowAddFriend(false);
  }

  function handleSplitBill(value) {
    setFriends((friends) =>
      friends.map((friend) =>
        friend.id === selectedFriend.id
          ? { ...friend, balance: friend.balance + value }
          : friend
      )
    );

    setSelectedFriend(null);
  }

  return (
    <div className="app">
      <div className="sidebar">
        <FriendsList
          friends={friends}
          selectedFriend={selectedFriend}
          onSelected={handleSelection}
        />

        {showAddFriend && <FormAddFriend onAddFriend={handleAddFriend} />}

        <Button onClick={handleShowAddFriend}>
          {showAddFriend ? "閉じる" : "友達を追加"}
        </Button>
      </div>

      {selectedFriend && (
        <FormSplitBill
          selectedFriend={selectedFriend}
          onSplitBill={handleSplitBill}
        />
      )}
    </div>
  );
}
```

---

## Step 4: index.js のインポートパスを更新

**`src/index.js` を更新:**
```jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './components/App';  // ← パスを更新

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

---

## Step 5: 動作確認

```bash
# 開発サーバーを起動
npm start

# ブラウザで動作確認
# - 友達リストが表示されるか
# - 友達を追加できるか
# - 割り勘フォームが動作するか
```

---

## Step 6: コミット

```bash
# 変更をステージング
git add .

# コミット
git commit -m "リファクタリング：コンポーネントを個別ファイルに分割"

# プッシュ
git push
```

---

## 最終的なディレクトリ構造

```
src/
├── components/
│   ├── App.jsx
│   ├── Button.jsx
│   ├── Friend.jsx
│   ├── FriendsList.jsx
│   ├── FormAddFriend.jsx
│   └── FormSplitBill.jsx
├── App.css
├── index.css
└── index.js
```

---

## メリット

1. **可読性の向上** - 各コンポーネントが独立したファイルになり、コードが見やすくなる
2. **保守性の向上** - 特定のコンポーネントだけを編集しやすくなる
3. **再利用性** - Button コンポーネントなど、他のプロジェクトでも使いやすくなる
4. **テストしやすい** - 個別のコンポーネントごとにユニットテストを書ける
5. **チーム開発** - 複数人で異なるコンポーネントを同時に編集できる

---

## 次のステップ（オプション）

- コンポーネントごとにCSSファイルを分割する（例: `Button.module.css`）
- `initialFriends` を別ファイル（例: `data/initialData.js`）に移動する
- PropTypesやTypeScriptで型チェックを追加する
